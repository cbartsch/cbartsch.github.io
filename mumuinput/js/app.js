"use strict";requirejs(["controller","connectingScreen","connectionErrorScreen","connectionLostScreen","characterScreen","controlScreen","utils","constants"],function(e,n,t,o,i,c,r,s){function a(e){e!==g&&(g&&r.addClass(g,"hidden"),g=e,r.removeClass(g,"hidden"))}function u(){a(n.getScreenElement()),r.requestFullscreen(document.body),m.disconnect();var e=s.HOST_STRING_TEMPLATE.replace("{0}",r.getCookie(s.HOST_NAME_COOKIE,s.DEFAULT_HOST));console.log("connect to",e),m.connect(e,r.getCookie(s.USER_NAME_COOKIE,s.DEFAULT_USER_NAME))}function d(){var e=document.getElementById("portrait-warning");m.isInputDisabled()?r.addClass(e,s.INPUT_DISABLED_CLASS):r.removeClass(e,s.INPUT_DISABLED_CLASS)}var E=r.getQueryParameters(),l=E[s.HOST_NAME_PARAMETER]||window.location.hostname;r.setCookie(s.HOST_NAME_COOKIE,l),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate||function(){console.log("vibrate not supported by browser")};var m=new e,g=n.getScreenElement();if(m.onConnect=function(){a(i.getScreenElement())},m.onDisconnect=function(){navigator.vibrate(250),a(o.getScreenElement())},m.onMessage=function(e){"deathCounter"in e&&(document.getElementById("deaths").innerHTML=e.deathCounter),"timer"in e&&(document.getElementById("timer").innerHTML=e.timer)},m.onError=function(e){console.error("Error during connection:",e),a(t.getScreenElement())},m.addAction(document.getElementById("thrust")),m.addAction(document.getElementById("break")),s.TOUCH_CONTROL){var S=document.getElementById("thrust");S.addEventListener("mousemove",function(e){var n=e.offsetX,t=n/S.offsetWidth*2-1;m.setAxis(t)})}n.init(),t.init(),o.init(),i.init(),c.init(),n.success=function(){a(i.getScreenElement())},n.fail=function(){m.disconnect(),a(t.getScreenElement())},t.success=function(){u()},i.success=function(e,n,t,o){m.startGame(e,n,t,o),r.requestFullscreen(document.body),a(c.getScreenElement())},c.success=function(){m.disconnect()},c.fail=function(){},c.ping=function(){m.sendMessage(JSON.stringify({type:s.MESSAGE_TYPE_PING}))},o.success=function(){u()},o.fail=function(){a(t.getScreenElement())},window.setInterval(m.sendInput,s.UPDATE_RATE),window.addEventListener("orientationchange",d),r.lockLandscapeOrientation(),u()});