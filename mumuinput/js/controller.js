"use strict";define(["utils"],function(n){return function(o){function t(){d.orientation=i(window.orientation),s.isInputDisabled()||(window.DeviceMotionEvent?d.orientation===r&&(d.axisScale=7.5*(window.orientation>0?1:-1)):window.DeviceOrientationEvent?d.axisScale=80*(window.orientation>0?1:-1):d.axisScale=1)}function i(n){return 0===n?a:r}function e(o){return n.clamp(o,-1,1)}function c(){s.onInput(d.controller)}var a="p",r="l",s=this,d={connection:void 0,orientation:i(window.orientation),axisScale:1,actionCount:0,controller:{id:o,axis:0}};s.connect=function(n){d.connection=new WebSocket(n),d.connection.onopen=function(){s.onConnect()},d.connection.onmessage=function(n){s.onMessage(n.data)},d.connection.onerror=function(n){s.onError(n)},d.connection.onclose=function(){s.onDisconnect()}},s.sendInput=function(){d.connection&&!s.isInputDisabled()&&d.connection.readyState===WebSocket.OPEN&&d.connection.send(JSON.stringify(d.controller))},s.disconnect=function(){d.connection&&!s.isInputDisabled()&&d.connection.readyState===WebSocket.OPEN&&(d.connection.close(),d.connection=void 0)},s.sendMessage=function(n){d.connection&&d.connection.readyState===WebSocket.OPEN&&d.connection.send(n)},s.getControllerData=function(){return d.controller},s.isInputDisabled=function(){return!(window.DeviceMotionEvent||d.orientation===r)},s.getAxisMethod=function(){return window.DeviceMotionEvent?"DeviceMotion":window.DeviceOrientationEvent?"DeviceOrientationEvent":"MozOrientation/Nothing"},s.addAction=function(n){function o(n){s.isInputDisabled()||(d.controller[e]=!0,c())}function t(n){s.isInputDisabled()||(d.controller[e]=!1,c())}var i=d.actionCount+1;d.actionCount=i;var e="action"+(i>1?i:"");d.controller[e]=!1,n.addEventListener("touchstart",o),n.addEventListener("touchend",t),n.addEventListener("mousedown",o),n.addEventListener("mouseup",t)},this.onConnect=function(){},this.onMessage=function(n){},this.onError=function(n){},this.onDisconnect=function(){},this.onInput=function(n){},t(),window.DeviceMotionEvent?window.addEventListener("devicemotion",function(n){s.isInputDisabled()||(d.controller.axis=e(n.accelerationIncludingGravity.y/d.axisScale),c())}):window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(n){s.isInputDisabled()||(d.controller.axis=e(n.beta/d.axisScale),c())}):window.addEventListener("MozOrientation",function(n){s.isInputDisabled()||(d.controller.axis=n.x,c())}),window.addEventListener("orientationchange",t)}});